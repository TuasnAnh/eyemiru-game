{"ast":null,"code":"// import ReactDOM from \"react-dom\";\n// import React from \"react\";\n// import LeaderBoard from \"../LeaderBoard\";\n// import axios from \"../../utils/axios\";\nimport { createViewportAwareInputHandler, Vector2 } from \"gdxjs\";\nimport createWorld from \"../utils/createWorld\";\nimport { getProductInBasketTex, getProductTexture, getFakeProductTex } from \"../utils/getProduct\";\nimport createLeaderBoardSystem from \"./LeaderBoardScreen\";\n\nconst createGameScreenSystem = Game => {\n  const {\n    width,\n    height,\n    canvas,\n    gl,\n    batch,\n    camera,\n    whiteTex,\n    assets,\n    viewport\n  } = Game;\n  const inputHandler = createViewportAwareInputHandler(canvas, viewport);\n  const TRAY_INITIAL_Y = height * 3.1 / 4;\n  const BASKET_TEX = assets.gameAssets.findRegion(\"basket_back\", -1);\n  const BASKET_WIDTH = width / 3.8;\n  const BASKET_HEIGHT = BASKET_WIDTH * BASKET_TEX.height / BASKET_WIDTH;\n  const productTex = getProductTexture(assets.gameAssets);\n  const fakeProductTex = getFakeProductTex(assets.gameAssets);\n  const productInBasketTex = getProductInBasketTex(assets.gameAssets);\n  const worldState = {\n    score: 0,\n    // keep\n    correctCatch: false,\n    // keep\n    stateTime: 0,\n    // keep\n    gameOver: false,\n    // keep\n    emptyLife: false,\n    // keep\n    life: [{\n      open: true\n    }, {\n      open: true\n    }, {\n      open: true\n    }],\n    // keep\n    lifeIndex: 2,\n    // life checking index // keep\n    basketState: {\n      x: width / 2,\n      y: TRAY_INITIAL_Y,\n      width: BASKET_WIDTH,\n      height: BASKET_HEIGHT,\n      position: new Vector2(width / 2, TRAY_INITIAL_Y),\n      target: new Vector2(width / 2, TRAY_INITIAL_Y),\n      moveLeft: false,\n      moveRight: false,\n      speed: width * 2.5\n    },\n    difficulty: 1,\n    // keep\n    collection: [],\n    // keep\n    collectionFinished: [],\n    // keep\n    products: [] // keep\n\n  };\n  const extra = {\n    canvas,\n    width,\n    height,\n    gl,\n    batch,\n    camera,\n    whiteTex,\n    inputHandler,\n    assets,\n    productTex,\n    fakeProductTex,\n    productInBasketTex\n  };\n  const world = createWorld(worldState, extra); // const goToLeaderBoardScreen = async () => {\n  //   Game.setCurrentScreen(await createLeaderBoardSystem(Game));\n  // };\n\n  const update = delta => {\n    if (!worldState.gameOver) {// check remaining life\n      //     countRemainLife = worldState.life.length;\n      //     for (let l of worldState.life) {\n      //       if (!l.red) {\n      //         countRemainLife--;\n      //       }\n      //     }\n      //     if (countRemainLife === 0 && oneTimeCheck) {\n      //       worldState.emptyLife = true;\n      //       oneTimeCheck = false;\n      //       for (let i = 0; i < worldState.foods.length; i++) {\n      //         worldState.redSmokeList.push({\n      //           x: worldState.foods[i].x,\n      //           y: worldState.foods[i].y,\n      //           stateTime: 0,\n      //           scale: worldState.foods[i].oriScale,\n      //         });\n      //       }\n      //       worldState.foods.length = 0;\n      //       worldState.gameOver = true;\n      //     }\n      //     // check finished current recipe\n      //     count = 0;\n      //     for (let rep of worldState.recipes) {\n      //       if (rep.finished) {\n      //         count++;\n      //       }\n      //     }\n      //     if (count === worldState.recipes.length) {\n      //       for (let i = 0; i < worldState.foods.length; i++) {\n      //         worldState.redSmokeList.push({\n      //           x: worldState.foods[i].x,\n      //           y: worldState.foods[i].y,\n      //           stateTime: 0,\n      //           scale: worldState.foods[i].oriScale,\n      //         });\n      //       }\n      //       genderNewRecipe();\n      //       worldState.genderNewRecipeAmount = true;\n      //       worldState.foods.length = 0;\n      //       worldState.collection.length = 0;\n      //       worldState.difficulty += 1;\n      //       // worldState.trayState.offsetCheckY = 0;\n      //     }\n      //     worldState.stateTime += delta;\n      //     world.update(delta);\n      //   } else {\n      //     // inputHandler.cleanup();\n      //     // world.update(delta, true);\n      //     Game.score = worldState.score;\n      //     goToLeaderBoardScreen();\n      //     // showLeaderBoard(worldState.score, restartGame);\n    }\n  };\n\n  return {\n    update,\n\n    destroy() {\n      inputHandler.cleanup();\n    }\n\n  };\n};\n\nexport default createGameScreenSystem;","map":{"version":3,"sources":["E:/game-project/eyemiru/src/screens/GameScreen.js"],"names":["createViewportAwareInputHandler","Vector2","createWorld","getProductInBasketTex","getProductTexture","getFakeProductTex","createLeaderBoardSystem","createGameScreenSystem","Game","width","height","canvas","gl","batch","camera","whiteTex","assets","viewport","inputHandler","TRAY_INITIAL_Y","BASKET_TEX","gameAssets","findRegion","BASKET_WIDTH","BASKET_HEIGHT","productTex","fakeProductTex","productInBasketTex","worldState","score","correctCatch","stateTime","gameOver","emptyLife","life","open","lifeIndex","basketState","x","y","position","target","moveLeft","moveRight","speed","difficulty","collection","collectionFinished","products","extra","world","update","delta","destroy","cleanup"],"mappings":"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","sourcesContent":["// import ReactDOM from \"react-dom\";\r\n// import React from \"react\";\r\n// import LeaderBoard from \"../LeaderBoard\";\r\n// import axios from \"../../utils/axios\";\r\n\r\nimport { createViewportAwareInputHandler, Vector2 } from \"gdxjs\";\r\nimport createWorld from \"../utils/createWorld\";\r\nimport {\r\n  getProductInBasketTex,\r\n  getProductTexture,\r\n  getFakeProductTex,\r\n} from \"../utils/getProduct\";\r\nimport createLeaderBoardSystem from \"./LeaderBoardScreen\";\r\n\r\nconst createGameScreenSystem = (Game) => {\r\n  const {\r\n    width,\r\n    height,\r\n    canvas,\r\n    gl,\r\n    batch,\r\n    camera,\r\n    whiteTex,\r\n    assets,\r\n    viewport,\r\n  } = Game;\r\n\r\n  const inputHandler = createViewportAwareInputHandler(canvas, viewport);\r\n  const TRAY_INITIAL_Y = (height * 3.1) / 4;\r\n\r\n  const BASKET_TEX = assets.gameAssets.findRegion(\"basket_back\", -1);\r\n  const BASKET_WIDTH = width / 3.8;\r\n  const BASKET_HEIGHT = (BASKET_WIDTH * BASKET_TEX.height) / BASKET_WIDTH;\r\n\r\n  const productTex = getProductTexture(assets.gameAssets);\r\n  const fakeProductTex = getFakeProductTex(assets.gameAssets);\r\n  const productInBasketTex = getProductInBasketTex(assets.gameAssets);\r\n\r\n  const worldState = {\r\n    score: 0, // keep\r\n    correctCatch: false, // keep\r\n    stateTime: 0, // keep\r\n    gameOver: false, // keep\r\n    emptyLife: false, // keep\r\n    life: [{ open: true }, { open: true }, { open: true }], // keep\r\n    lifeIndex: 2, // life checking index // keep\r\n    basketState: {\r\n      x: width / 2,\r\n      y: TRAY_INITIAL_Y,\r\n      width: BASKET_WIDTH,\r\n      height: BASKET_HEIGHT,\r\n      position: new Vector2(width / 2, TRAY_INITIAL_Y),\r\n      target: new Vector2(width / 2, TRAY_INITIAL_Y),\r\n      moveLeft: false,\r\n      moveRight: false,\r\n      speed: width * 2.5,\r\n    },\r\n    difficulty: 1, // keep\r\n    collection: [], // keep\r\n    collectionFinished: [], // keep\r\n    products: [], // keep\r\n  };\r\n\r\n  const extra = {\r\n    canvas,\r\n    width,\r\n    height,\r\n    gl,\r\n    batch,\r\n    camera,\r\n    whiteTex,\r\n    inputHandler,\r\n    assets,\r\n    productTex,\r\n    fakeProductTex,\r\n    productInBasketTex,\r\n  };\r\n  const world = createWorld(worldState, extra);\r\n\r\n  // const goToLeaderBoardScreen = async () => {\r\n  //   Game.setCurrentScreen(await createLeaderBoardSystem(Game));\r\n  // };\r\n\r\n  const update = (delta) => {\r\n    if (!worldState.gameOver) {\r\n      // check remaining life\r\n      //     countRemainLife = worldState.life.length;\r\n      //     for (let l of worldState.life) {\r\n      //       if (!l.red) {\r\n      //         countRemainLife--;\r\n      //       }\r\n      //     }\r\n      //     if (countRemainLife === 0 && oneTimeCheck) {\r\n      //       worldState.emptyLife = true;\r\n      //       oneTimeCheck = false;\r\n      //       for (let i = 0; i < worldState.foods.length; i++) {\r\n      //         worldState.redSmokeList.push({\r\n      //           x: worldState.foods[i].x,\r\n      //           y: worldState.foods[i].y,\r\n      //           stateTime: 0,\r\n      //           scale: worldState.foods[i].oriScale,\r\n      //         });\r\n      //       }\r\n      //       worldState.foods.length = 0;\r\n      //       worldState.gameOver = true;\r\n      //     }\r\n      //     // check finished current recipe\r\n      //     count = 0;\r\n      //     for (let rep of worldState.recipes) {\r\n      //       if (rep.finished) {\r\n      //         count++;\r\n      //       }\r\n      //     }\r\n      //     if (count === worldState.recipes.length) {\r\n      //       for (let i = 0; i < worldState.foods.length; i++) {\r\n      //         worldState.redSmokeList.push({\r\n      //           x: worldState.foods[i].x,\r\n      //           y: worldState.foods[i].y,\r\n      //           stateTime: 0,\r\n      //           scale: worldState.foods[i].oriScale,\r\n      //         });\r\n      //       }\r\n      //       genderNewRecipe();\r\n      //       worldState.genderNewRecipeAmount = true;\r\n      //       worldState.foods.length = 0;\r\n      //       worldState.collection.length = 0;\r\n      //       worldState.difficulty += 1;\r\n      //       // worldState.trayState.offsetCheckY = 0;\r\n      //     }\r\n      //     worldState.stateTime += delta;\r\n      //     world.update(delta);\r\n      //   } else {\r\n      //     // inputHandler.cleanup();\r\n      //     // world.update(delta, true);\r\n      //     Game.score = worldState.score;\r\n      //     goToLeaderBoardScreen();\r\n      //     // showLeaderBoard(worldState.score, restartGame);\r\n    }\r\n  };\r\n\r\n  return {\r\n    update,\r\n    destroy() {\r\n      inputHandler.cleanup();\r\n    },\r\n  };\r\n};\r\n\r\nexport default createGameScreenSystem;\r\n"]},"metadata":{},"sourceType":"module"}