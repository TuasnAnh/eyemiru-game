{"ast":null,"code":"var shuffle=function shuffle(array){array.sort(function(){return Math.random()-0.5;});};var getDelayBaseOnDifficulty=function getDelayBaseOnDifficulty(difficulty){if(difficulty>=1&&difficulty<=3){return 1;}else if(difficulty>=4&&difficulty<=6){return 2;}else if(difficulty>=7&&difficulty<=9){return 1.5;}else{return 1;}};var getShootTypeBaseOnDifficulty=function getShootTypeBaseOnDifficulty(difficulty){if(difficulty>=1&&difficulty<=2){return{minNumber:0,maxNumber:2};}else if(difficulty>=3&&difficulty<=7){return{minNumber:0,maxNumber:3};}else{return{minNumber:0,maxNumber:5};}};var getPattern=function getPattern(number,width,height){var timer=0;var x=[];if(number===0){timer=[0];x=[Math.random()*(width*0.8-width*0.15)+width*0.15];}return{timer:timer,x:x};};var createProductSpawnSystem=function createProductSpawnSystem(){var delayTime=2;var pattern;var timer=0;var index=0;var xIndex=0;return{update:function update(delta,worldState,_ref){var width=_ref.width,height=_ref.height,productTex=_ref.productTex,fakeProductTex=_ref.fakeProductTex;var difficulty=worldState.difficulty,products=worldState.products;if(worldState.stateTime>delayTime&&pattern===undefined){var _getShootTypeBaseOnDi=getShootTypeBaseOnDifficulty(difficulty),minNumber=_getShootTypeBaseOnDi.minNumber,maxNumber=_getShootTypeBaseOnDi.maxNumber;// pattern = getPattern(\n//   Math.round(Math.random() * (maxNumber - minNumber) + minNumber),\n//   width,\n//   height\n// );\npattern=getPattern(0,width,height);timer=worldState.stateTime+pattern.timer[index];}if(worldState.stateTime>delayTime&&worldState.stateTime>timer&&pattern!==undefined){index=Math.min(index+=1,pattern.timer.length);timer=worldState.stateTime+pattern.timer[index];// loop to check every same timer products\nvar loop=1;var tmpIndex=index-1;while(true){if(pattern.timer[tmpIndex]===pattern.timer[tmpIndex+1]&&tmpIndex<pattern.timer.length){tmpIndex=Math.min(tmpIndex+=1,pattern.timer.length);loop+=1;}else{break;}}// add to products list\nfor(var i=0;i<loop;i++){if(i>0){index=Math.min(index+=1,pattern.timer.length);}timer=worldState.stateTime+pattern.timer[index];// TODO: get random product\nvar isFake=true;var randomProduct=Math.floor(Math.random()*fakeProductTex.length);if(Math.random()>0.3){isFake=false;randomProduct=Math.floor(Math.random()*productTex.length);}products.push({type:randomProduct,// type: 2,\nisFake:isFake,stateTime:0,x:pattern.x[xIndex],y:-height/8,speedY:0});xIndex=Math.min(xIndex+=1,pattern.x.length-1);}if(index===pattern.timer.length){delayTime=worldState.stateTime+getDelayBaseOnDifficulty(difficulty);index=0;xIndex=0;pattern=undefined;}}}};};export default createProductSpawnSystem;","map":{"version":3,"sources":["E:/game-project/eyemiru/src/systems/ProductSpawnSystem.js"],"names":["shuffle","array","sort","Math","random","getDelayBaseOnDifficulty","difficulty","getShootTypeBaseOnDifficulty","minNumber","maxNumber","getPattern","number","width","height","timer","x","createProductSpawnSystem","delayTime","pattern","index","xIndex","update","delta","worldState","productTex","fakeProductTex","products","stateTime","undefined","min","length","loop","tmpIndex","i","isFake","randomProduct","floor","push","type","y","speedY"],"mappings":"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","sourcesContent":["const shuffle = (array) => {\r\n  array.sort(() => Math.random() - 0.5);\r\n};\r\n\r\nconst getDelayBaseOnDifficulty = (difficulty) => {\r\n  if (difficulty >= 1 && difficulty <= 3) {\r\n    return 1;\r\n  } else if (difficulty >= 4 && difficulty <= 6) {\r\n    return 2;\r\n  } else if (difficulty >= 7 && difficulty <= 9) {\r\n    return 1.5;\r\n  } else {\r\n    return 1;\r\n  }\r\n};\r\n\r\nconst getShootTypeBaseOnDifficulty = (difficulty) => {\r\n  if (difficulty >= 1 && difficulty <= 2) {\r\n    return { minNumber: 0, maxNumber: 2 };\r\n  } else if (difficulty >= 3 && difficulty <= 7) {\r\n    return { minNumber: 0, maxNumber: 3 };\r\n  } else {\r\n    return { minNumber: 0, maxNumber: 5 };\r\n  }\r\n};\r\n\r\nconst getPattern = (number, width, height) => {\r\n  let timer = 0;\r\n  let x = [];\r\n\r\n  if (number === 0) {\r\n    timer = [0];\r\n    x = [Math.random() * (width * 0.8 - width * 0.15) + width * 0.15];\r\n  }\r\n\r\n  return { timer, x };\r\n};\r\n\r\nconst createProductSpawnSystem = () => {\r\n  let delayTime = 2;\r\n  let pattern;\r\n  let timer = 0;\r\n  let index = 0;\r\n  let xIndex = 0;\r\n  return {\r\n    update(delta, worldState, { width, height, productTex, fakeProductTex }) {\r\n      const { difficulty, products } = worldState;\r\n\r\n      if (worldState.stateTime > delayTime && pattern === undefined) {\r\n        const { minNumber, maxNumber } = getShootTypeBaseOnDifficulty(\r\n          difficulty\r\n        );\r\n        // pattern = getPattern(\r\n        //   Math.round(Math.random() * (maxNumber - minNumber) + minNumber),\r\n        //   width,\r\n        //   height\r\n        // );\r\n        pattern = getPattern(0, width, height);\r\n        timer = worldState.stateTime + pattern.timer[index];\r\n      }\r\n\r\n      if (\r\n        worldState.stateTime > delayTime &&\r\n        worldState.stateTime > timer &&\r\n        pattern !== undefined\r\n      ) {\r\n        index = Math.min((index += 1), pattern.timer.length);\r\n        timer = worldState.stateTime + pattern.timer[index];\r\n\r\n        // loop to check every same timer products\r\n        let loop = 1;\r\n        let tmpIndex = index - 1;\r\n        while (true) {\r\n          if (\r\n            pattern.timer[tmpIndex] === pattern.timer[tmpIndex + 1] &&\r\n            tmpIndex < pattern.timer.length\r\n          ) {\r\n            tmpIndex = Math.min((tmpIndex += 1), pattern.timer.length);\r\n            loop += 1;\r\n          } else {\r\n            break;\r\n          }\r\n        }\r\n\r\n        // add to products list\r\n        for (let i = 0; i < loop; i++) {\r\n          if (i > 0) {\r\n            index = Math.min((index += 1), pattern.timer.length);\r\n          }\r\n          timer = worldState.stateTime + pattern.timer[index];\r\n\r\n          // TODO: get random product\r\n          let isFake = true;\r\n          let randomProduct = Math.floor(Math.random() * fakeProductTex.length);\r\n          if (Math.random() > 0.3) {\r\n            isFake = false;\r\n            randomProduct = Math.floor(Math.random() * productTex.length);\r\n          }\r\n\r\n          products.push({\r\n            type: randomProduct,\r\n            // type: 2,\r\n            isFake,\r\n            stateTime: 0,\r\n            x: pattern.x[xIndex],\r\n            y: -height / 8,\r\n            speedY: 0,\r\n          });\r\n\r\n          xIndex = Math.min((xIndex += 1), pattern.x.length - 1);\r\n        }\r\n\r\n        if (index === pattern.timer.length) {\r\n          delayTime =\r\n            worldState.stateTime + getDelayBaseOnDifficulty(difficulty);\r\n          index = 0;\r\n          xIndex = 0;\r\n          pattern = undefined;\r\n        }\r\n      }\r\n    },\r\n  };\r\n};\r\n\r\nexport default createProductSpawnSystem;\r\n"]},"metadata":{},"sourceType":"module"}