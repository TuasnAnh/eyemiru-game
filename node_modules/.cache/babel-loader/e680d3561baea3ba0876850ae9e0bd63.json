{"ast":null,"code":"const shuffle = array => {\n  array.sort(() => Math.random() - 0.5);\n};\n\nconst getDelayBaseOnDifficulty = difficulty => {\n  if (difficulty >= 1 && difficulty <= 3) {\n    return 2.5;\n  } else if (difficulty >= 4 && difficulty <= 6) {\n    return 2;\n  } else if (difficulty >= 7 && difficulty <= 9) {\n    return 1.5;\n  } else {\n    return 1;\n  }\n};\n\nconst getShootTypeBaseOnDifficulty = difficulty => {\n  if (difficulty >= 1 && difficulty <= 2) {\n    return {\n      minNumber: 0,\n      maxNumber: 2\n    };\n  } else if (difficulty >= 3 && difficulty <= 7) {\n    return {\n      minNumber: 0,\n      maxNumber: 3\n    };\n  } else {\n    return {\n      minNumber: 0,\n      maxNumber: 5\n    };\n  }\n};\n\nconst getPattern = (number, width, height) => {\n  let timer = 0;\n  let x = [];\n\n  if (number === 0) {\n    timer = [0];\n    x = [width / 2];\n  }\n\n  return {\n    timer,\n    x\n  };\n};\n\nconst createProductSpawnSystem = () => {\n  let delayTime = 2;\n  let pattern;\n  let timer = 0;\n  let index = 0;\n  let xIndex = 0;\n  return {\n    update(delta, worldState, {\n      width,\n      height\n    }) {\n      const {\n        difficulty,\n        products\n      } = worldState;\n\n      if (worldState.stateTime > delayTime && pattern === undefined) {\n        const {\n          minNumber,\n          maxNumber\n        } = getShootTypeBaseOnDifficulty(difficulty); // pattern = getPattern(\n        //   Math.round(Math.random() * (maxNumber - minNumber) + minNumber),\n        //   width,\n        //   height\n        // );\n\n        pattern = getPattern(0, width, height);\n        timer = worldState.stateTime + pattern.timer[index];\n      }\n\n      if (worldState.stateTime > delayTime && worldState.stateTime > timer && pattern !== undefined) {\n        index = Math.min(index += 1, pattern.timer.length);\n        timer = worldState.stateTime + pattern.timer[index]; // loop to check every same timer products\n\n        let loop = 1;\n        let tmpIndex = index - 1;\n\n        while (true) {\n          if (pattern.timer[tmpIndex] === pattern.timer[tmpIndex + 1] && tmpIndex < pattern.timer.length) {\n            tmpIndex = Math.min(tmpIndex += 1, pattern.timer.length);\n            loop += 1;\n          } else {\n            break;\n          }\n        } // add to products list\n\n\n        for (let i = 0; i < loop; i++) {\n          if (i > 0) {\n            index = Math.min(index += 1, pattern.timer.length);\n          }\n\n          timer = worldState.stateTime + pattern.timer[index]; // TODO: get random product\n\n          let randomProduct = 0;\n          let isFaked = false;\n          products.push({\n            type: randomProduct,\n            isFaked,\n            stateTime: 0,\n            x: pattern.x[xIndex],\n            y: -height / 20,\n            speedY: 0\n          });\n          xIndex = Math.min(xIndex += 1, pattern.x.length - 1);\n        }\n\n        if (index === pattern.timer.length) {\n          delayTime = worldState.stateTime + getDelayBaseOnDifficulty(difficulty);\n          index = 0;\n          xIndex = 0;\n          pattern = undefined;\n        }\n      }\n    }\n\n  };\n};\n\nexport default createProductSpawnSystem;","map":{"version":3,"sources":["E:/game-project/eyemiru/src/screens/ProductSpawnSystem.js"],"names":["shuffle","array","sort","Math","random","getDelayBaseOnDifficulty","difficulty","getShootTypeBaseOnDifficulty","minNumber","maxNumber","getPattern","number","width","height","timer","x","createProductSpawnSystem","delayTime","pattern","index","xIndex","update","delta","worldState","products","stateTime","undefined","min","length","loop","tmpIndex","i","randomProduct","isFaked","push","type","y","speedY"],"mappings":"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","sourcesContent":["const shuffle = (array) => {\r\n  array.sort(() => Math.random() - 0.5);\r\n};\r\n\r\nconst getDelayBaseOnDifficulty = (difficulty) => {\r\n  if (difficulty >= 1 && difficulty <= 3) {\r\n    return 2.5;\r\n  } else if (difficulty >= 4 && difficulty <= 6) {\r\n    return 2;\r\n  } else if (difficulty >= 7 && difficulty <= 9) {\r\n    return 1.5;\r\n  } else {\r\n    return 1;\r\n  }\r\n};\r\n\r\nconst getShootTypeBaseOnDifficulty = (difficulty) => {\r\n  if (difficulty >= 1 && difficulty <= 2) {\r\n    return { minNumber: 0, maxNumber: 2 };\r\n  } else if (difficulty >= 3 && difficulty <= 7) {\r\n    return { minNumber: 0, maxNumber: 3 };\r\n  } else {\r\n    return { minNumber: 0, maxNumber: 5 };\r\n  }\r\n};\r\n\r\nconst getPattern = (number, width, height) => {\r\n  let timer = 0;\r\n  let x = [];\r\n\r\n  if (number === 0) {\r\n    timer = [0];\r\n    x = [width / 2];\r\n  }\r\n\r\n  return { timer, x };\r\n};\r\n\r\nconst createProductSpawnSystem = () => {\r\n  let delayTime = 2;\r\n  let pattern;\r\n  let timer = 0;\r\n  let index = 0;\r\n  let xIndex = 0;\r\n  return {\r\n    update(delta, worldState, { width, height }) {\r\n      const { difficulty, products } = worldState;\r\n\r\n      if (worldState.stateTime > delayTime && pattern === undefined) {\r\n        const { minNumber, maxNumber } = getShootTypeBaseOnDifficulty(\r\n          difficulty\r\n        );\r\n        // pattern = getPattern(\r\n        //   Math.round(Math.random() * (maxNumber - minNumber) + minNumber),\r\n        //   width,\r\n        //   height\r\n        // );\r\n        pattern = getPattern(0, width, height);\r\n        timer = worldState.stateTime + pattern.timer[index];\r\n      }\r\n\r\n      if (\r\n        worldState.stateTime > delayTime &&\r\n        worldState.stateTime > timer &&\r\n        pattern !== undefined\r\n      ) {\r\n        index = Math.min((index += 1), pattern.timer.length);\r\n        timer = worldState.stateTime + pattern.timer[index];\r\n\r\n        // loop to check every same timer products\r\n        let loop = 1;\r\n        let tmpIndex = index - 1;\r\n        while (true) {\r\n          if (\r\n            pattern.timer[tmpIndex] === pattern.timer[tmpIndex + 1] &&\r\n            tmpIndex < pattern.timer.length\r\n          ) {\r\n            tmpIndex = Math.min((tmpIndex += 1), pattern.timer.length);\r\n            loop += 1;\r\n          } else {\r\n            break;\r\n          }\r\n        }\r\n\r\n        // add to products list\r\n        for (let i = 0; i < loop; i++) {\r\n          if (i > 0) {\r\n            index = Math.min((index += 1), pattern.timer.length);\r\n          }\r\n          timer = worldState.stateTime + pattern.timer[index];\r\n\r\n          // TODO: get random product\r\n          let randomProduct = 0;\r\n          let isFaked = false;\r\n          products.push({\r\n            type: randomProduct,\r\n            isFaked,\r\n            stateTime: 0,\r\n            x: pattern.x[xIndex],\r\n            y: -height / 20,\r\n            speedY: 0,\r\n          });\r\n\r\n          xIndex = Math.min((xIndex += 1), pattern.x.length - 1);\r\n        }\r\n\r\n        if (index === pattern.timer.length) {\r\n          delayTime =\r\n            worldState.stateTime + getDelayBaseOnDifficulty(difficulty);\r\n          index = 0;\r\n          xIndex = 0;\r\n          pattern = undefined;\r\n        }\r\n      }\r\n    },\r\n  };\r\n};\r\n\r\nexport default createProductSpawnSystem;\r\n"]},"metadata":{},"sourceType":"module"}