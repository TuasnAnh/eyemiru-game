{"ast":null,"code":"import { Vector2 } from \"gdxjs\";\n\nconst createStarEffectRenderSystem = () => {\n  let startTex;\n  let S1_WIDTH, S1_HEIGHT;\n  let tmp = new Vector2();\n  return {\n    init(worldState, {\n      assets,\n      width,\n      height\n    }) {\n      const atlas = assets.gameAssets;\n      startTex = atlas.findRegion(\"star\", -1);\n      S1_WIDTH = width / 8;\n      S1_HEIGHT = S1_WIDTH * startTex.height / startTex.width;\n    },\n\n    update(delta, {\n      starList,\n      basketState\n    }, {\n      batch,\n      camera,\n      width,\n      height\n    }) {\n      batch.setProjection(camera.combined);\n      batch.begin();\n\n      for (let i = starList.length - 1; i >= 0; i--) {\n        if (starList[i].type === 0) {\n          starList[i].stateTime += delta;\n          starList[i].accuX += delta * starList[i].speedX;\n\n          if (starList[i].accuX < basketState.width * 2 / 3) {\n            starList[i].scale += delta * starList[i].scaleSpeed;\n          } else {\n            starList[i].scale -= delta * starList[i].scaleSpeed * 1.5;\n          }\n\n          startTex.draw(batch, basketState.x - basketState.width / 2 + starList[i].accuX - S1_WIDTH / 2, basketState.y - basketState.height * 0.7 - S1_HEIGHT / 2, S1_WIDTH, S1_HEIGHT, S1_WIDTH / 2, S1_HEIGHT / 2, 0, starList[i].scale, starList[i].scale);\n\n          if (starList[i].stateTime > starList[i].time) {\n            starList.splice(i, 1);\n          }\n        } else {\n          for (let j = 0; j < 3; j++) {\n            const target = starList[i].target[j];\n            const position = starList[i].position;\n            tmp.setVector(target).subVector(position).nor().scale(starList[i].speed[j] * delta);\n\n            if (target.distanceSqr(position) <= tmp.len2()) {\n              starList[i].position.setVector(starList[i].target[j]);\n            } else {\n              starList[i].position.addVector(tmp);\n            }\n          }\n        }\n      }\n\n      batch.end();\n    }\n\n  };\n};\n\nexport default createStarEffectRenderSystem;","map":{"version":3,"sources":["E:/game-project/eyemiru/src/systems/StarEffectRenderSystem.js"],"names":["Vector2","createStarEffectRenderSystem","startTex","S1_WIDTH","S1_HEIGHT","tmp","init","worldState","assets","width","height","atlas","gameAssets","findRegion","update","delta","starList","basketState","batch","camera","setProjection","combined","begin","i","length","type","stateTime","accuX","speedX","scale","scaleSpeed","draw","x","y","time","splice","j","target","position","setVector","subVector","nor","speed","distanceSqr","len2","addVector","end"],"mappings":"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","sourcesContent":["import { Vector2 } from \"gdxjs\";\r\n\r\nconst createStarEffectRenderSystem = () => {\r\n  let startTex;\r\n  let S1_WIDTH, S1_HEIGHT;\r\n  let tmp = new Vector2();\r\n  return {\r\n    init(worldState, { assets, width, height }) {\r\n      const atlas = assets.gameAssets;\r\n      startTex = atlas.findRegion(\"star\", -1);\r\n\r\n      S1_WIDTH = width / 8;\r\n      S1_HEIGHT = (S1_WIDTH * startTex.height) / startTex.width;\r\n    },\r\n    update(delta, { starList, basketState }, { batch, camera, width, height }) {\r\n      batch.setProjection(camera.combined);\r\n      batch.begin();\r\n\r\n      for (let i = starList.length - 1; i >= 0; i--) {\r\n        if (starList[i].type === 0) {\r\n          starList[i].stateTime += delta;\r\n          starList[i].accuX += delta * starList[i].speedX;\r\n          if (starList[i].accuX < (basketState.width * 2) / 3) {\r\n            starList[i].scale += delta * starList[i].scaleSpeed;\r\n          } else {\r\n            starList[i].scale -= delta * starList[i].scaleSpeed * 1.5;\r\n          }\r\n          startTex.draw(\r\n            batch,\r\n            basketState.x -\r\n              basketState.width / 2 +\r\n              starList[i].accuX -\r\n              S1_WIDTH / 2,\r\n            basketState.y - basketState.height * 0.7 - S1_HEIGHT / 2,\r\n            S1_WIDTH,\r\n            S1_HEIGHT,\r\n            S1_WIDTH / 2,\r\n            S1_HEIGHT / 2,\r\n            0,\r\n            starList[i].scale,\r\n            starList[i].scale\r\n          );\r\n\r\n          if (starList[i].stateTime > starList[i].time) {\r\n            starList.splice(i, 1);\r\n          }\r\n        } else {\r\n          for (let j = 0; j < 3; j++) {\r\n            const target = starList[i].target[j];\r\n            const position = starList[i].position;\r\n            tmp\r\n              .setVector(target)\r\n              .subVector(position)\r\n              .nor()\r\n              .scale(starList[i].speed[j] * delta);\r\n            if (target.distanceSqr(position) <= tmp.len2()) {\r\n              starList[i].position.setVector(starList[i].target[j]);\r\n            } else {\r\n              starList[i].position.addVector(tmp);\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      batch.end();\r\n    },\r\n  };\r\n};\r\n\r\nexport default createStarEffectRenderSystem;\r\n"]},"metadata":{},"sourceType":"module"}